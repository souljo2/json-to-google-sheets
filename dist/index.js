!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("fs"),require("readline"),require("googleapis"),require("flat")):"function"==typeof define&&define.amd?define(["exports","fs","readline","googleapis","flat"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).bundle={},e.fs,e.readline,e.googleapis,e.flat)}(this,(function(e,t,r,n,i){"use strict";function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var u=o(t),a=o(r),s=o(i),c=function(){return(c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function l(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{s(n.next(e))}catch(e){o(e)}}function a(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}s((n=n.apply(e,t||[])).next())}))}function f(e,t){var r,n,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(e,u)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var h="token.json",d=function(){function e(e){this._scopes=["https://www.googleapis.com/auth/drive","https://www.googleapis.com/auth/spreadsheets"],this._isCachedTokenRequired=(null==e?void 0:e.isCachedTokenRequired)||!1}return Object.defineProperty(e.prototype,"isCachedTokenRequired",{get:function(){return this._isCachedTokenRequired},enumerable:!1,configurable:!0}),e.prototype._getAuthToken=function(){if(this.isCachedTokenRequired&&u.default.existsSync(h))try{var e=u.default.readFileSync(h);return JSON.parse(e.toString())}catch(e){return void console.error("Failed to read previous auth token",e)}},e.prototype._genNewToken=function(e){return l(this,void 0,void 0,(function(){var t,r=this;return f(this,(function(n){return t=e.generateAuthUrl({access_type:"offline",scope:this._scopes,prompt:"consent"}),console.info("\n> Authorize user app by visiting this url:",t),[2,new Promise((function(t,n){var i=a.default.createInterface({input:process.stdin,output:process.stdout});i.question("> Enter the code from that page here: ",(function(o){i.close(),e.getToken(o,(function(i,o){if(i)return console.error("> Error occured while trying to retrieve access token",i),n(i);if(e.setCredentials(o),r.isCachedTokenRequired)try{u.default.writeFileSync(h,JSON.stringify(o))}catch(e){console.error("> Error occured while trying to store access token",i)}t(e)}))}))}))]}))}))},e.prototype.authorize=function(e){var t=e.clientId,r=e.clientSecret,i=e.redirectUri;return l(this,void 0,void 0,(function(){var e,o,u;return f(this,(function(a){switch(a.label){case 0:e=new n.google.auth.OAuth2(t,r,i),a.label=1;case 1:return a.trys.push([1,5,,6]),o=this._getAuthToken(),this.isCachedTokenRequired&&o?(e.setCredentials(o),[3,4]):[3,2];case 2:return[4,this._genNewToken(e)];case 3:e=a.sent(),a.label=4;case 4:return this._oAuth2Client=e,[3,6];case 5:throw u=a.sent(),console.error("Failed to authorize client"),console.error(u),u;case 6:return[2]}}))}))},e.prototype.invokeTask=function(e,t){if(!this._oAuth2Client)throw new Error("Unauthorized");return e(this._oAuth2Client,t)},e}(),p=n.google.sheets("v4"),v=n.google.drive("v3");function g(e){var t=e[0],r=e.slice(1),n=t.slice(1),i={};return n.forEach((function(e,t){i[e]={}})),r.forEach((function(e){var t=e[0],r=e.slice(1);r.forEach((function(e,r){var o=n[r];i[o][t]=e}));for(var o=n.length-r.length;o;){var u=n[r.length+o-1];i[u][t]="",o--}})),i}e.JSONToGoogleSheet=d,e.batchGetSheet=function(e,t){return l(this,void 0,void 0,(function(){var r;return f(this,(function(n){switch(n.label){case 0:return r=c(c({},t),{auth:e}),[4,p.spreadsheets.values.batchGet(r)];case 1:return[2,n.sent()]}}))}))},e.clearSheet=function(e,t){return l(this,void 0,void 0,(function(){var r;return f(this,(function(n){switch(n.label){case 0:return r=c(c({},t),{auth:e}),[4,p.spreadsheets.values.clear(r)];case 1:return[2,n.sent()]}}))}))},e.createSheet=function(e,t){return l(this,void 0,void 0,(function(){var r;return f(this,(function(n){switch(n.label){case 0:return r=c(c({},t),{auth:e}),[4,p.spreadsheets.create(r)];case 1:return[2,n.sent()]}}))}))},e.deleteSheet=function(e,t){return l(this,void 0,void 0,(function(){var r;return f(this,(function(n){switch(n.label){case 0:return r=c(c({},t),{auth:e}),[4,v.files.delete(r)];case 1:return[2,n.sent()]}}))}))},e.getFlattedJSON=function(e){return s.default.flatten(e)},e.getJSONFromSheetData=g,e.getSheet=function(e,t){return l(this,void 0,void 0,(function(){var r;return f(this,(function(n){switch(n.label){case 0:return r=c(c({},t),{auth:e}),[4,p.spreadsheets.values.get(r)];case 1:return[2,n.sent()]}}))}))},e.listFiles=function(e,t){return l(this,void 0,void 0,(function(){var r;return f(this,(function(n){switch(n.label){case 0:return r=c(c({},t),{auth:e}),[4,v.files.list(r)];case 1:return[2,n.sent()]}}))}))},e.mergeJSONWithSheetData=function(e,t,r){var n=e[0],i=n.slice(1),o={},u=g(e);for(var a in i.forEach((function(e,t){o[e]=t})),t)if(!u[r][a])for(var s in o)u[s][a]=r===s?t[a]:"";var c=[];for(var a in u[r]){var l=[a];for(var s in o)l.push(u[s][a]);c.push(l)}return function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],u=0,a=o.length;u<a;u++,i++)n[i]=o[u];return n}([n],c)},e.updateSheet=function(e,t){return l(this,void 0,void 0,(function(){var r;return f(this,(function(n){switch(n.label){case 0:return r=c(c({},t),{auth:e}),[4,p.spreadsheets.values.update(r)];case 1:return[2,n.sent()]}}))}))},e.writeJSONFile=function(e,t,r){if(u.default.existsSync(e))throw new Error("The file alreay exists");if(r&&(r.update&&u.default.unlinkSync(e),r.raw))u.default.writeFileSync(e,JSON.stringify(t),"utf-8");else{var n=s.default.unflatten(t,{object:!0});u.default.writeFileSync(e,JSON.stringify(n),"utf-8")}},Object.defineProperty(e,"__esModule",{value:!0})}));
